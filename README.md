# Telegram Jewish Joke Bot

Небольшой Telegram-бот для чатов с друзьями и коллегами.
На слова **«предсказание»** или **«хочу предсказание»** он отвечает одним
из заранее зашитых еврейских анекдотов.

Финальный текст ответа бота:

> Вот твоё анекдот-предсказание на сегодня...  
> *[один из 20 анекдотов из списка]*

Бот **не придумывает** анекдоты сам — он всегда выбирает один из 20
предопределённых.

---

## Логика работы бота

1. Telegram отправляет обновление (update) на вебхук `POST /webhook`.
2. Приложение (`main.py`) принимает JSON и проверяет, есть ли в нём поле `message`.
3. Если сообщение не от бота и в тексте содержится слово **«предсказание»**
   или фраза **«хочу предсказание»** (в любом регистре) — бот срабатывает.
4. Бот случайным образом выбирает один из 20 анекдотов из списка `JOKES`.
5. Бот формирует ответ:
   ```
   Вот твоё анекдот-предсказание на сегодня...

   [один из анекдотов]
   ```
6. Через метод `sendMessage` Telegram API бот отправляет ответ в чат.
7. Если нужных ключевых слов нет — бот ничего не делает, чтобы не флудить.

---

## Структура проекта

```text
telegram-jewish-joke-bot/
├── main.py          # Основное приложение Flask с логикой вебхука
├── requirements.txt # Python-зависимости
├── render.yaml      # Blueprint-конфигурация для Render.com
├── README.md        # Документация и инструкции по запуску
└── .gitignore       # Игнорируемые файлы в git
```

---

## Локальный запуск на Mac

1. Установи Python 3.10+ (на Mac обычно уже есть, но лучше проверить):
   ```bash
   python3 --version
   ```

2. Клонируй репозиторий или разархивируй папку с проектом:
   ```bash
   cd telegram-jewish-joke-bot
   ```

3. (Опционально) Создай виртуальное окружение:
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```

4. Установи зависимости:
   ```bash
   pip install -r requirements.txt
   ```

5. Задай переменную окружения с токеном бота:
   ```bash
   export TELEGRAM_BOT_TOKEN="твой_токен_от_BotFather"
   ```

6. Запусти приложение:
   ```bash
   python3 main.py
   ```

   По умолчанию сервер стартует на `http://0.0.0.0:5000/`.

   Для локальной отладки вебхука можно использовать, например, `ngrok`
   (но для Render это не нужно — там будет свой внешний URL).

---

## Деплой на Render.com (бесплатный план, Blueprint)

### 1. Подготовка репозитория

1. Создай новый репозиторий на GitHub.
2. Добавь файлы проекта и сделай коммит:
   ```bash
   git init
   git add .
   git commit -m "Initial commit: Telegram Jewish Joke Bot"
   git branch -M main
   git remote add origin git@github.com:username/telegram-jewish-joke-bot.git
   git push -u origin main
   ```

### 2. Создание бота и получение токена

1. Открой Telegram и найди @BotFather.
2. Выполни команду `/newbot`, придумай имя и @username.
3. Скопируй выданный **HTTP API token** — он понадобится для переменной
   `TELEGRAM_BOT_TOKEN`.

### 3. Настройка сервиса на Render

1. Зайди на [Render.com](https://render.com) и авторизуйся.
2. Нажми **New +** → **Blueprint**.
3. Укажи свой GitHub-репозиторий с этим проектом.
4. Render обнаружит файл `render.yaml` и предложит создать web service:
   - `type: web`
   - `env: python`
   - `plan: free` (бесплатный тариф)
   - `buildCommand: pip install -r requirements.txt`
   - `startCommand: gunicorn main:app`
5. Нажми **Apply** / **Create Web Service**.

После деплоя Render выдаст тебе внешний URL вида:
```text
https://твоё-имя-сервиса.onrender.com
```

---

## Настройка вебхука для Telegram

Webhook необходимо указать вручную для твоего бота.

Пусть твой внешний URL от Render такой:

```text
https://твоё-имя-сервиса.onrender.com
```

Тогда URL вебхука будет:

```text
https://твоё-имя-сервиса.onrender.com/webhook
```

Чтобы Telegram отправлял обновления на этот адрес, выполни команду
на своём Mac в терминале (подставь свой токен и URL):

```bash
curl -X POST "https://api.telegram.org/botТВОЙ_ТОКЕН/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://твоё-имя-сервиса.onrender.com/webhook"}'
```

Пример (НЕ копируй токен, используй свой!):

```bash
curl -X POST "https://api.telegram.org/bot123456789:ABCDEF1234567890/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://my-joke-bot.onrender.com/webhook"}'
```

Если всё прошло успешно, Telegram вернёт JSON с `{"ok":true, ...}`.

---

## Добавление бота в чаты

1. Найди своего бота по юзернейму в Telegram.
2. Добавь его в нужные групповые чаты.
3. Убедись, что у бота есть права читать сообщения:
   - В настройках бота через @BotFather можно отключить **Privacy Mode**,
     чтобы бот видел все сообщения в группе.
4. Теперь напиши в чате:
   - `предсказание`  
   или  
   - `хочу предсказание`

   В ответ бот должен прислать:

   ```
   Вот твоё анекдот-предсказание на сегодня...

   [случайный еврейский анекдот из списка]
   ```

---

## Безопасность и деньги

- В проекте нет платных SDK, платных API или функций,
  которые автоматически тратят деньги.
- Используются только:
  - бесплатный Telegram Bot API;
  - бесплатный план Render (`plan: free` в `render.yaml`);
  - бесплатные Python-библиотеки Flask и requests.
- Все сетевые запросы идут только в Telegram API для отправки сообщений.

---

## Краткое резюме логики

- Бот реагирует **строго** на фразы:
  - `предсказание`
  - `хочу предсказание`
- Каждый триггер → один ответ с текстом:
  - `Вот твоё анекдот-предсказание на сегодня...`
  - пустая строка
  - один случайный анекдот из 20 заранее заданных.
- Никакого самостоятельного придумывания анекдотов.
- Никакого лишнего флуда в чате.
